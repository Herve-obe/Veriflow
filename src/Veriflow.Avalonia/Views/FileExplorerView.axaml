<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Veriflow.Avalonia.ViewModels"
             xmlns:models="using:Veriflow.Avalonia.Models"
             mc:Ignorable="d" d:DesignWidth="300" d:DesignHeight="600"
             x:Class="Veriflow.Avalonia.Views.FileExplorerView"
             x:DataType="vm:FileExplorerViewModel">
    
    <UserControl.Styles>
        <!-- TreeView Style (VS Code inspired) -->
        <Style Selector="TreeView">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
        
        <!-- TreeViewItem Style -->
        <Style Selector="TreeViewItem">
            <Setter Property="Padding" Value="4,2"/>
            <Setter Property="Background" Value="Transparent"/>
        </Style>
        
        <!-- TreeViewItem Hover -->
        <Style Selector="TreeViewItem:pointerover /template/ ContentPresenter#PART_HeaderPresenter">
            <Setter Property="Background" Value="#1AFFFFFF"/>
        </Style>
        
        <!-- TreeViewItem Selected -->
        <Style Selector="TreeViewItem:selected /template/ ContentPresenter#PART_HeaderPresenter">
            <Setter Property="Background" Value="#1A1A4CB1"/>
            <Setter Property="BorderBrush" Value="#1A4CB1"/>
            <Setter Property="BorderThickness" Value="2,0,0,0"/>
        </Style>
    </UserControl.Styles>
    
    <TreeView ItemsSource="{Binding RootNodes}"
              SelectionMode="Single">
        
        <TreeView.ItemTemplate>
            <TreeDataTemplate ItemsSource="{Binding Children}"
                            x:DataType="models:DirectoryNode">
                <StackPanel Orientation="Horizontal" 
                           Spacing="6"
                           PointerPressed="TreeItem_PointerPressed">
                    
                    <!-- Fixed Drive Icon (HDD/SSD) - Updated Style -->
                    <PathIcon Width="16" Height="16"
                             Foreground="{DynamicResource Brush.Accent}"
                             Data="M6,2H18C19.1,2 20,2.9 20,4V20C20,21.1 19.1,22 18,22H6C4.9,22 4,21.1 4,20V4C4,2.9 4.9,2 6,2M6,4V14H18V4H6M12,17A2,2 0 0,0 10,19A2,2 0 0,0 12,21A2,2 0 0,0 14,19A2,2 0 0,0 12,17Z"
                             IsVisible="{Binding NodeType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static models:DirectoryNodeType.FixedDrive}}"/>
                    
                    <!-- Removable Drive Icon (USB/SD) - Updated Style to match HDD as requested -->
                    <PathIcon Width="16" Height="16"
                             Foreground="{DynamicResource Brush.Accent}"
                             Data="M6,2H18C19.1,2 20,2.9 20,4V20C20,21.1 19.1,22 18,22H6C4.9,22 4,21.1 4,20V4C4,2.9 4.9,2 6,2M6,4V14H18V4H6M12,17A2,2 0 0,0 10,19A2,2 0 0,0 12,21A2,2 0 0,0 14,19A2,2 0 0,0 12,17Z"
                             IsVisible="{Binding NodeType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static models:DirectoryNodeType.RemovableDrive}}"/>
                    
                    <!-- Network Drive Icon - Updated Style -->
                    <PathIcon Width="16" Height="16"
                             Foreground="{DynamicResource Brush.Accent}"
                             Data="M6,2H18C19.1,2 20,2.9 20,4V20C20,21.1 19.1,22 18,22H6C4.9,22 4,21.1 4,20V4C4,2.9 4.9,2 6,2M6,4V14H18V4H6M12,17A2,2 0 0,0 10,19A2,2 0 0,0 12,21A2,2 0 0,0 14,19A2,2 0 0,0 12,17Z"
                             IsVisible="{Binding NodeType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static models:DirectoryNodeType.NetworkDrive}}"/>
                    
                    <!-- CD/DVD Icon (Kept distinct or updated? User said 'supports de stockage'. CD is one too. I'll keep distinct or use generic? Let's keep CD distinct but use Accent color for consistency?) -->
                    <!-- I will just update Foreground to Accent and keep icon for differentiation unless user insists on ALL. 
                         User said "remplace l'icone des supports de stockage". Usually means HDD/SSD/USB. CD is Optical. 
                         I'll stick to updating Fixed/Removable/Network. -->
                    <PathIcon Width="16" Height="16"
                             Foreground="{DynamicResource Brush.Accent}"
                             Data="M12,2C6.48,2,2,6.48,2,12s4.48,10,10,10s10-4.48,10-10S17.52,2,12,2z M12,4c4.41,0,8,3.59,8,8s-3.59,8-8,8s-8-3.59-8-8S7.59,4,12,4z M12,10c-1.1,0-2,0.9-2,2s0.9,2,2,2s2-0.9,2-2S13.1,10,12,10z"
                             IsVisible="{Binding NodeType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static models:DirectoryNodeType.CDRom}}"/>
                    
                    <!-- Folder Icon (Default - Folder Color #DCB67A) -->
                    <PathIcon Width="16" Height="16"
                             Foreground="#DCB67A"
                             Data="M10,4H4C2.89,4,2,4.89,2,6v12c0,1.1,0.9,2,2,2h16c1.1,0,2-0.9,2-2V8c0-1.1-0.9-2-2-2h-8L10,4z"
                             IsVisible="{Binding NodeType, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static models:DirectoryNodeType.Folder}}"/>
                    
                    <!-- Directory Name (Drive: Bold) -->
                    <TextBlock Text="{Binding Name}"
                               Foreground="#CCCCCC"
                               FontSize="12"
                               FontWeight="Bold"
                               VerticalAlignment="Center"
                               IsVisible="{Binding IsDrive}"/>
                               
                    <!-- Directory Name (Folder: SemiBold) -->
                    <TextBlock Text="{Binding Name}"
                               Foreground="#CCCCCC"
                               FontSize="12"
                               FontWeight="SemiBold"
                               VerticalAlignment="Center"
                               IsVisible="{Binding IsFolder}"/>
                </StackPanel>
            </TreeDataTemplate>
        </TreeView.ItemTemplate>
        
        <!-- Bind IsExpanded and IsSelected to DirectoryNode properties -->
        <TreeView.Styles>
            <Style Selector="TreeViewItem" x:DataType="models:DirectoryNode">
                <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
                <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}"/>
            </Style>
        </TreeView.Styles>
        
    </TreeView>
    
</UserControl>
