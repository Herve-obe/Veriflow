<UserControl x:Class="Veriflow.Desktop.Views.AudioMetadataView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Veriflow.Desktop.Views"
             xmlns:vm="clr-namespace:Veriflow.Desktop.ViewModels"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="350">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>

    <Border Padding="10" VerticalAlignment="Stretch" Background="{StaticResource Brush.Panel}" BorderBrush="{StaticResource Brush.Border}" BorderThickness="1,0,0,0" CornerRadius="0">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- Header -->
                <RowDefinition Height="*"/>    <!-- Content -->
                <RowDefinition Height="Auto"/> <!-- Buttons -->
            </Grid.RowDefinitions>

            <!-- Header Title -->
            <TextBlock Text="METADATA" Style="{StaticResource HeaderStyle}" Margin="0,0,0,20"/>

            <!-- Content Area (Metadata) -->
            <ScrollViewer Grid.Row="1" Focusable="False" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <ScrollViewer.Resources>
                        <Style TargetType="{x:Type ScrollBar}" BasedOn="{StaticResource ModernScrollBarStyle}"/>
                </ScrollViewer.Resources>
                <StackPanel>
                    <!-- 1. GENERAL INFO -->
                        <Expander Header="GENERAL INFO" IsExpanded="False" Style="{StaticResource ProExpanderStyle}" Focusable="False">
                            <Grid Margin="5,0,5,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="80"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <TextBlock Text="Name:" Foreground="{DynamicResource Brush.Text.Secondary}"/>
                                <TextBlock Grid.Column="1" Text="{Binding CurrentMetadata.FullPath}" TextWrapping="Wrap" Foreground="White" ToolTip="{Binding CurrentMetadata.FullPath}"/>
                                
                                <TextBlock Grid.Row="1" Text="Project:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding CurrentMetadata.Project}" Foreground="White" Margin="0,2,0,0"/>

                                <TextBlock Grid.Row="2" Text="Scene:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding CurrentMetadata.Scene}" Foreground="White" FontWeight="Bold" Margin="0,2,0,0"/>

                                <TextBlock Grid.Row="3" Text="Take:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding CurrentMetadata.Take}" Foreground="White" FontWeight="Bold" Margin="0,2,0,0"/>

                                <TextBlock Grid.Row="4" Text="Tape:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding CurrentMetadata.Tape}" Foreground="White" Margin="0,2,0,0"/>
                                
                                <TextBlock Grid.Row="5" Text="Date:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding CurrentMetadata.CreationDate}" Foreground="White" Margin="0,2,0,0"/>

                                <TextBlock Grid.Row="6" Text="Size:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,5,0,0"/>
                                <TextBlock Grid.Row="6" Grid.Column="1" Text="{Binding CurrentMetadata.FileSize}" Foreground="White" Margin="0,5,0,0"/>
                            </Grid>
                        </Expander>

                        <!-- 2. RECORDING INFO -->
                        <Expander Header="RECORDING INFO" IsExpanded="False" Style="{StaticResource ProExpanderStyle}" Focusable="False">
                            <Grid Margin="5,0,5,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="110"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Text="Sample Rate:" Foreground="{DynamicResource Brush.Text.Secondary}"/>
                                <TextBlock Grid.Column="1" Text="{Binding CurrentMetadata.SampleRateString}" Foreground="White"/>

                                <TextBlock Grid.Row="1" Text="Bit Depth:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding CurrentMetadata.BitDepthString}" Foreground="White" Margin="0,2,0,0"/>

                                <TextBlock Grid.Row="2" Text="Frame Rate:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding CurrentMetadata.FrameRate}" Foreground="White" Margin="0,2,0,0"/>

                                <TextBlock Grid.Row="3" Text="Start TC:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding CurrentMetadata.TimecodeStart}" FontFamily="Consolas" Foreground="White" FontWeight="Bold" Margin="0,2,0,0"/>

                                <TextBlock Grid.Row="4" Text="Length:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding CurrentMetadata.Duration}" FontFamily="Consolas" Foreground="White" Margin="0,2,0,0"/>

                                <TextBlock Grid.Row="5" Text="User Bits:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding CurrentMetadata.UBits}" FontFamily="Consolas" Foreground="White" Margin="0,2,0,0"/>
                                
                                <TextBlock Grid.Row="6" Text="Bitrate:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="6" Grid.Column="1" Text="{Binding CurrentMetadata.Bitrate}" Foreground="White" Margin="0,2,0,0"/>

                                <TextBlock Grid.Row="7" Text="Bitrate Mode:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="7" Grid.Column="1" Text="{Binding CurrentMetadata.BitrateMode}" Foreground="White" Margin="0,2,0,0"/>
                            </Grid>
                        </Expander>


                    <!-- 3. TECHNICAL INFO -->
                    <Expander Header="TECHNICAL INFO" IsExpanded="False" Style="{StaticResource ProExpanderStyle}" Focusable="False">
                        <Grid Margin="5,0,5,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="110"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Text="Container:" Foreground="{DynamicResource Brush.Text.Secondary}"/>
                            <TextBlock Grid.Column="1" Text="{Binding CurrentMetadata.ContainerFormat}" Foreground="White"/>

                            <TextBlock Grid.Row="1" Text="Codec:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding CurrentMetadata.CodecName}" Foreground="White" Margin="0,2,0,0"/>

                            <TextBlock Grid.Row="2" Text="Channels:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                            <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding CurrentMetadata.ChannelCountString}" Foreground="White" Margin="0,2,0,0"/>
                        </Grid>
                    </Expander>

                    <!-- 3. UCS INFO -->
                    <Expander Header="UCS INFO" IsExpanded="False" Style="{StaticResource ProExpanderStyle}" Focusable="False">
                        <Grid Margin="5,0,5,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="110"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Text="Category:" Foreground="{DynamicResource Brush.Text.Secondary}"/>
                            <TextBlock Grid.Column="1" Text="{Binding CurrentMetadata.UCSCategory}" Foreground="White"/>

                            <TextBlock Grid.Row="1" Text="SubCategory:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding CurrentMetadata.UCSSubCategory}" Foreground="White" Margin="0,2,0,0"/>

                            <TextBlock Grid.Row="2" Text="CatID:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                            <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding CurrentMetadata.UCSCatID}" Foreground="White" FontFamily="Consolas" Margin="0,2,0,0"/>
                        </Grid>
                    </Expander>

                    <!-- 4. TRACK INFO -->
                    <Expander Header="TRACK INFO" IsExpanded="True" Style="{StaticResource ProExpanderStyle}" Focusable="False">
                        <DataGrid ItemsSource="{Binding CurrentMetadata.Tracks}" 
                                  AutoGenerateColumns="False" 
                                  CanUserAddRows="False" 
                                  IsReadOnly="True"
                                  HeadersVisibility="Column"
                                  GridLinesVisibility="Horizontal"
                                  Background="Transparent"
                                  BorderThickness="0"
                                  RowBackground="Transparent"
                                  Foreground="White"
                                  Margin="0,0,20,10">
                            <DataGrid.Resources>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Foreground" Value="{DynamicResource Brush.Text.Secondary}"/>
                                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                    <Setter Property="BorderBrush" Value="{DynamicResource Brush.Border.Secondary}"/>
                                    <Setter Property="Padding" Value="5,2"/>
                                </Style>
                                <Style TargetType="DataGridCell">
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Foreground" Value="White"/>
                                    <Setter Property="Padding" Value="2"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="DataGridCell">
                                                <Border Padding="{TemplateBinding Padding}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}" SnapsToDevicePixels="True">
                                                    <ContentPresenter SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </DataGrid.Resources>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="#" Binding="{Binding ChannelIndex}" Width="30"/>
                                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
                                <DataGridTextColumn Header="Function" Binding="{Binding Function}" Width="90"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Expander>
                </StackPanel>
            </ScrollViewer>

            <!-- Action Buttons Area (Bottom) -->
            <StackPanel Grid.Row="2" Margin="0,10,0,0">
                <Button Command="{Binding LoadFileCommand}"
                        Height="26" ToolTip="Import Audio File" Margin="0,0,0,5"
                        Style="{StaticResource ContextualActionButtonStyle}">
                    <StackPanel Orientation="Horizontal">
                        <Path Data="M19,20H4C2.89,20 2,19.1 2,18V6C2,4.89 2.89,4 4,4H10L12,6H19A2,2 0 0,0 21,8H21L4,8V18L6.14,10H23.21L20.93,18.5C20.7,19.37 19.92,20 19,20Z"
                              Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                              Width="16" Height="16" Stretch="Uniform" Margin="0,0,8,0"/>
                        <TextBlock Text="Open File"/>
                    </StackPanel>
                </Button>
                
                <Button Command="{Binding UnloadMediaCommand}"
                        Height="26" ToolTip="Unload current media" Margin="0,0,0,5"
                        Style="{StaticResource ContextualActionButtonStyle}">
                    <StackPanel Orientation="Horizontal">
                        <Path Data="M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,6.47 6.47,2 12,2M15.59,7L12,10.59L8.41,7L7,8.41L10.59,12L7,15.59L8.41,17L12,13.41L15.59,17L17,15.59L13.41,12L17,8.41L15.59,7Z"
                              Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                              Width="16" Height="16" Stretch="Uniform" Margin="0,0,8,0"/>
                        <TextBlock Text="Close File"/>
                    </StackPanel>
                </Button>

                <Button Command="{Binding SendFileToTranscodeCommand}"
                        Height="26" ToolTip="Send current file to Transcode Page" Margin="0,0,0,5"
                        Style="{StaticResource ContextualActionButtonStyle}">
                    <StackPanel Orientation="Horizontal">
                        <Path Data="M12,3C7.58,3 4,4.79 4,7C4,9.21 7.58,11 12,11C16.42,11 20,9.21 20,7C20,4.79 16.42,3 12,3M4,9V12C4,14.21 7.58,16 12,16C16.42,16 20,14.21 20,12V9C20,11.21 16.42,13 12,13C7.58,13 4,11.21 4,9M4,14V17C4,19.21 7.58,21 12,21C16.42,21 20,19.21 20,17V14C20,16.21 16.42,18 12,18C7.58,18 4,16.21 4,14Z"
                              Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                              Width="16" Height="16" Stretch="Uniform" Margin="0,0,8,0"/>
                        <TextBlock Text="Transcode"/>
                    </StackPanel>
                </Button>
                        
                <Button Command="{Binding ModifyInReportCommand}"
                        Height="26" ToolTip="Navigate to Reports Page with this item" Margin="0,0,0,0"
                        Style="{StaticResource ContextualActionButtonStyle}">
                    <StackPanel Orientation="Horizontal">
                        <Path Data="M14,10H19.5L14,4.5V10M5,3H15L21,9V19A2,2 0 0,1 19,21H5C3.89,21 3,20.1 3,19V5C3,3.89 3.89,3 5,3M14.5,17.5L12.5,15.5L14,14L16,16L20.5,11.5L22,13L16,19L14.5,17.5Z"
                              Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                              Width="16" Height="16" Stretch="Uniform" Margin="0,0,8,0"/>
                        <TextBlock Text="Update Notes"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>
    </Border>

</UserControl>
