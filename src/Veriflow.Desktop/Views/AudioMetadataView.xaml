<UserControl x:Class="Veriflow.Desktop.Views.AudioMetadataView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Veriflow.Desktop.Views"
             xmlns:vm="clr-namespace:Veriflow.Desktop.ViewModels"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="350">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>

    <Border Padding="10" VerticalAlignment="Stretch" Background="{StaticResource Brush.Panel}" BorderBrush="{StaticResource Brush.Border}" BorderThickness="1,0,0,0" CornerRadius="0">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- Buttons -->
                <RowDefinition Height="*"/>    <!-- Layout -->
                <RowDefinition Height="Auto"/> <!-- Bottom Actions -->
            </Grid.RowDefinitions>

            <!-- Action Buttons Area (Vertical Stack) -->
            <StackPanel Grid.Row="0" Margin="0,0,0,41">
                <Button Command="{Binding LoadFileCommand}"
                        Content="OPEN FILE" Height="26" ToolTip="Import Audio File" Margin="0,0,0,5"
                        Style="{StaticResource BlueActionButtonStyle}"/>
                
                <Button Command="{Binding UnloadMediaCommand}"
                        Content="CLOSE FILE" Height="26" ToolTip="Unload current media" Margin="0,0,0,20"
                        Style="{StaticResource BlueActionButtonStyle}"/>

                <Button Command="{Binding SendFileToTranscodeCommand}"
                        Content="SEND TO TRANSCODE" Height="26" ToolTip="Send current file to Transcode Page"
                        Style="{StaticResource BlueActionButtonStyle}"/>
            </StackPanel>

            <ScrollViewer Grid.Row="1" Focusable="False" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <ScrollViewer.Resources>
                        <Style TargetType="{x:Type ScrollBar}" BasedOn="{StaticResource ModernScrollBarStyle}"/>
                </ScrollViewer.Resources>
                <StackPanel>
                    <!-- 1. GENERAL INFO -->
                        <Expander Header="GENERAL INFO" IsExpanded="True" Style="{StaticResource ProExpanderStyle}">
                            <Grid Margin="5,0,5,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="80"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <TextBlock Text="Name:" Foreground="{DynamicResource Brush.Text.Secondary}"/>
                                <TextBlock Grid.Column="1" Text="{Binding CurrentMetadata.FullPath}" TextWrapping="Wrap" Foreground="White" ToolTip="{Binding CurrentMetadata.FullPath}"/>
                                
                                <TextBlock Grid.Row="1" Text="Project:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding CurrentMetadata.Project}" Foreground="White" Margin="0,2,0,0"/>

                                <TextBlock Grid.Row="2" Text="Scene:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding CurrentMetadata.Scene}" Foreground="White" FontWeight="Bold" Margin="0,2,0,0"/>

                                <TextBlock Grid.Row="3" Text="Take:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding CurrentMetadata.Take}" Foreground="White" FontWeight="Bold" Margin="0,2,0,0"/>

                                <TextBlock Grid.Row="4" Text="Tape:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding CurrentMetadata.Tape}" Foreground="White" Margin="0,2,0,0"/>
                                
                                <TextBlock Grid.Row="5" Text="Date:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding CurrentMetadata.CreationDate}" Foreground="White" Margin="0,2,0,0"/>

                                <TextBlock Grid.Row="6" Text="Size:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,5,0,0"/>
                                <TextBlock Grid.Row="6" Grid.Column="1" Text="{Binding CurrentMetadata.FileSize}" Foreground="White" Margin="0,5,0,0"/>
                            </Grid>
                        </Expander>

                        <!-- 2. RECORDING INFO -->
                        <Expander Header="RECORDING INFO" IsExpanded="True" Style="{StaticResource ProExpanderStyle}">
                            <Grid Margin="5,0,5,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="110"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Text="Sample Rate:" Foreground="{DynamicResource Brush.Text.Secondary}"/>
                                <TextBlock Grid.Column="1" Text="{Binding CurrentMetadata.SampleRateString}" Foreground="White"/>

                                <TextBlock Grid.Row="1" Text="Bit Depth:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding CurrentMetadata.BitDepthString}" Foreground="White" Margin="0,2,0,0"/>

                                <TextBlock Grid.Row="2" Text="Frame Rate:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding CurrentMetadata.FrameRate}" Foreground="White" Margin="0,2,0,0"/>

                                <TextBlock Grid.Row="3" Text="Start TC:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding CurrentMetadata.TimecodeStart}" FontFamily="Consolas" Foreground="White" FontWeight="Bold" Margin="0,2,0,0"/>

                                <TextBlock Grid.Row="4" Text="Length:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding CurrentMetadata.Duration}" FontFamily="Consolas" Foreground="White" Margin="0,2,0,0"/>

                                <TextBlock Grid.Row="5" Text="User Bits:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding CurrentMetadata.UBits}" FontFamily="Consolas" Foreground="White" Margin="0,2,0,0"/>
                                
                                <TextBlock Grid.Row="6" Text="Bitrate:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="6" Grid.Column="1" Text="{Binding CurrentMetadata.Bitrate}" Foreground="White" Margin="0,2,0,0"/>

                                <TextBlock Grid.Row="7" Text="Bitrate Mode:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                                <TextBlock Grid.Row="7" Grid.Column="1" Text="{Binding CurrentMetadata.BitrateMode}" Foreground="White" Margin="0,2,0,0"/>
                            </Grid>
                        </Expander>


                    <!-- 3. TECHNICAL INFO -->
                    <Expander Header="TECHNICAL INFO" IsExpanded="True" Style="{StaticResource ProExpanderStyle}">
                        <Grid Margin="5,0,5,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="110"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Text="Container:" Foreground="{DynamicResource Brush.Text.Secondary}"/>
                            <TextBlock Grid.Column="1" Text="{Binding CurrentMetadata.ContainerFormat}" Foreground="White"/>

                            <TextBlock Grid.Row="1" Text="Codec:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding CurrentMetadata.CodecName}" Foreground="White" Margin="0,2,0,0"/>

                            <TextBlock Grid.Row="2" Text="Channels:" Foreground="{DynamicResource Brush.Text.Secondary}" Margin="0,2,0,0"/>
                            <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding CurrentMetadata.ChannelCountString}" Foreground="White" Margin="0,2,0,0"/>
                        </Grid>
                    </Expander>

                    <!-- 4. TRACK INFO -->
                    <Expander Header="TRACK INFO" IsExpanded="True" Style="{StaticResource ProExpanderStyle}">
                        <DataGrid ItemsSource="{Binding CurrentMetadata.Tracks}" 
                                  AutoGenerateColumns="False" 
                                  CanUserAddRows="False" 
                                  IsReadOnly="True"
                                  HeadersVisibility="Column"
                                  GridLinesVisibility="Horizontal"
                                  Background="Transparent"
                                  BorderThickness="0"
                                  RowBackground="Transparent"
                                  Foreground="White"
                                  Margin="0,0,20,10">
                            <DataGrid.Resources>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Foreground" Value="{DynamicResource Brush.Text.Secondary}"/>
                                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                    <Setter Property="BorderBrush" Value="{DynamicResource Brush.Border.Secondary}"/>
                                    <Setter Property="Padding" Value="5,2"/>
                                </Style>
                                <Style TargetType="DataGridCell">
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Foreground" Value="White"/>
                                    <Setter Property="Padding" Value="2"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="DataGridCell">
                                                <Border Padding="{TemplateBinding Padding}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}" SnapsToDevicePixels="True">
                                                    <ContentPresenter SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </DataGrid.Resources>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="#" Binding="{Binding ChannelIndex}" Width="30"/>
                                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
                                <DataGridTextColumn Header="Function" Binding="{Binding Function}" Width="90"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Expander>
                </StackPanel>
            </ScrollViewer>

            <!-- BOTTOM ACTIONS -->
            <Button Grid.Row="2" Command="{Binding ModifyInReportCommand}"
                    Content="UPDATE REPORT NOTES" Height="26" ToolTip="Navigate to Reports Page with this item" Margin="0,10,0,0"
                    Style="{StaticResource BlueActionButtonStyle}"/>
        </Grid>
    </Border>

</UserControl>
