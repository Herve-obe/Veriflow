<UserControl x:Class="Veriflow.Desktop.Views.TranscodeView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:local="clr-namespace:Veriflow.Desktop.Views"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="1024">

    <Grid>
        <Grid.Resources>
            <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
            
            <!-- Helpers for ComboBox Template (Moved to top for StaticResource resolution) -->
            <ControlTemplate x:Key="ComboBoxToggleButton" TargetType="ToggleButton">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition Width="20" />
                    </Grid.ColumnDefinitions>
                    <Border x:Name="Border" 
                            Grid.ColumnSpan="2"
                            CornerRadius="2"
                            Background="#333333"
                            BorderBrush="#555"
                            BorderThickness="1" />
                    <Path x:Name="Arrow"
                          Grid.Column="1"     
                          Fill="White"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                          Data="M 0 0 L 4 4 L 8 0 Z"/>
                </Grid>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsMouseOver" Value="true">
                        <Setter TargetName="Border" Property="Background" Value="#444" />
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>

            <ControlTemplate x:Key="ComboBoxTextBox" TargetType="TextBox">
                <Border x:Name="PART_ContentHost" Focusable="False" Background="{TemplateBinding Background}" />
            </ControlTemplate>

            <!-- Dark DataGrid Header Style (Replaces GridViewColumnHeader) -->
            <Style TargetType="DataGridColumnHeader">
                <Setter Property="Background" Value="#333333"/>
                <Setter Property="Foreground" Value="White"/>
                <Setter Property="Padding" Value="6,8"/>
                <Setter Property="BorderThickness" Value="0,0,1,0"/>
                <Setter Property="BorderBrush" Value="#444"/>
                <Setter Property="HorizontalContentAlignment" Value="Left"/>
                <Setter Property="FontWeight" Value="Bold"/>
                <Setter Property="Height" Value="35"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="DataGridColumnHeader">
                            <Grid>
                                <Border Background="{TemplateBinding Background}"
                                        BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="{TemplateBinding BorderThickness}"
                                        Padding="{TemplateBinding Padding}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" 
                                                          VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                                          SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                        <Path x:Name="SortArrow"
                                              Grid.Column="1"
                                              Data="M0,0 L10,0 L5,5 z"
                                              Fill="#AAA"
                                              Margin="5,0,0,0"
                                              VerticalAlignment="Center"
                                              Visibility="Collapsed"
                                              Stretch="Fill" 
                                              Width="8" Height="6"/>
                                    </Grid>
                                </Border>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="SortDirection" Value="Ascending">
                                    <Setter TargetName="SortArrow" Property="Visibility" Value="Visible" />
                                    <Setter TargetName="SortArrow" Property="LayoutTransform">
                                        <Setter.Value>
                                            <RotateTransform Angle="180" />
                                        </Setter.Value>
                                    </Setter>
                                </Trigger>
                                <Trigger Property="SortDirection" Value="Descending">
                                    <Setter TargetName="SortArrow" Property="Visibility" Value="Visible" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- DataGrid Cell Style to avoid default selection colors -->
            <Style TargetType="DataGridCell">
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="DataGridCell">
                            <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" SnapsToDevicePixels="True">
                                <ContentPresenter SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
                <Style.Triggers>
                    <Trigger Property="IsSelected" Value="True">
                        <Setter Property="Background" Value="#444"/>
                        <Setter Property="Foreground" Value="White"/>
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- Dark DataGrid Row Style (Fixes white background) -->
            <Style x:Key="DataGridRowStyle" TargetType="DataGridRow">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Foreground" Value="White"/>
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="#2A2A2A"/>
                    </Trigger>
                    <Trigger Property="IsSelected" Value="True">
                        <Setter Property="Background" Value="#444"/>
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- Dark ComboBox Style -->
            <Style TargetType="ComboBox">
                <Setter Property="Background" Value="#333333"/>
                <Setter Property="Foreground" Value="White"/>
                <Setter Property="BorderBrush" Value="#555"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Padding" Value="10,6"/>
                <Setter Property="Height" Value="32"/>
                <Setter Property="VerticalContentAlignment" Value="Center"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ComboBox">
                            <Grid>
                                <ToggleButton Name="ToggleButton" 
                                              Template="{StaticResource ComboBoxToggleButton}" 
                                              Grid.Column="2" 
                                              Focusable="false"
                                              IsChecked="{Binding Path=IsDropDownOpen,Mode=TwoWay,RelativeSource={RelativeSource TemplatedParent}}"
                                              ClickMode="Press">
                                </ToggleButton>
                                <ContentPresenter Name="ContentSite" IsHitTestVisible="False"  Content="{TemplateBinding SelectionBoxItem}"
                                                  ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                                  ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                                  Margin="10,3,23,3"
                                                  VerticalAlignment="Center"
                                                  HorizontalAlignment="Left" />
                                <TextBox x:Name="PART_EditableTextBox"
                                         Style="{x:Null}"
                                         Template="{StaticResource ComboBoxTextBox}"
                                         HorizontalAlignment="Left" 
                                         VerticalAlignment="Center" 
                                         Margin="3,3,23,3"
                                         Focusable="True" 
                                         Background="Transparent"
                                         Visibility="Hidden"
                                         IsReadOnly="{TemplateBinding IsReadOnly}"/>
                                <Popup Name="Popup"
                                       Placement="Bottom"
                                       IsOpen="{TemplateBinding IsDropDownOpen}"
                                       AllowsTransparency="True" 
                                       Focusable="False"
                                       PopupAnimation="Slide">
                                    <Grid Name="DropDown"
                                          SnapsToDevicePixels="True"
                                          MinWidth="{TemplateBinding ActualWidth}"
                                          MaxHeight="{TemplateBinding MaxDropDownHeight}">
                                        <Border x:Name="DropDownBorder"
                                                Background="#333333"
                                                BorderThickness="1"
                                                BorderBrush="#555"/>
                                        <ScrollViewer Margin="4,6,4,6" SnapsToDevicePixels="True">
                                            <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained" />
                                        </ScrollViewer>
                                    </Grid>
                                </Popup>
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </Grid.Resources>
        
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>   <!-- File List Area -->
            <ColumnDefinition Width="350"/> <!-- Settings Panel -->
        </Grid.ColumnDefinitions>

        <!-- LEFT COLUMN: HEADER + FILE LIST -->
        <Grid Grid.Column="0" Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- Header -->
                <RowDefinition Height="*"/>    <!-- File List -->
            </Grid.RowDefinitions>

            <!-- HEADER -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                 <Path Data="M12,6V9L16,5L12,1V4A8,8 0 0,0 4,12C4,13.57 4.46,15.03 5.24,16.26L6.7,14.8C6.25,13.97 6,13 6,12A6,6 0 0,1 12,6M18.76,7.74L17.3,9.2C17.74,10.04 18,11 18,12A6,6 0 0,1 12,18V15L8,19L12,23V20A8,8 0 0,0 20,12C20,10.43 19.54,8.97 18.76,7.74Z"
                       Fill="{DynamicResource Brush.Accent}"
                       Height="20" Width="20" Stretch="Uniform"
                       VerticalAlignment="Center" Margin="0,0,10,0"/>
                <TextBlock Text="TRANSCODE" Style="{StaticResource HeaderStyle}" VerticalAlignment="Center"/>
            </StackPanel>

            <!-- FILE LIST CONTENT -->
            <Grid Grid.Row="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <Grid Margin="0,0,0,5">
                    <TextBlock Text="FILE LIST" Style="{StaticResource LabelStyle}" VerticalAlignment="Center" Opacity="0.5"/>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="ADD FILE(S)" Command="{Binding AddFilesCommand}" 
                                Style="{StaticResource BlueActionButtonStyle}" 
                                Width="120" Height="26" FontSize="11" 
                                Margin="0,0,10,0"/>
                        <Button Content="CLEAR LIST" Command="{Binding ClearListCommand}" 
                                Style="{StaticResource BlueActionButtonStyle}" 
                                Width="100" Height="26" FontSize="11"/>
                    </StackPanel>
                </Grid>
                
                <!-- Drop Area / List -->
                <Border Grid.Row="1" Background="{StaticResource Brush.Panel.Deep}" BorderBrush="{StaticResource Brush.Border}" BorderThickness="1" CornerRadius="4">
                    <Grid>
                         <!-- Drag Drop Behavior Overlay -->
                         <i:Interaction.Triggers>
                            <i:EventTrigger EventName="Drop">
                                <i:InvokeCommandAction Command="{Binding DropFilesCommand}" PassEventArgsToCommand="True"/>
                            </i:EventTrigger>
                        </i:Interaction.Triggers>

                        <!-- DATA GRID REPLACEMENT -->
                        <DataGrid ItemsSource="{Binding Files}" 
                                  AutoGenerateColumns="False" 
                                  CanUserSortColumns="True"
                                  Background="Transparent" 
                                  BorderThickness="0" 
                                  GridLinesVisibility="None"
                                  HeadersVisibility="Column"
                                  RowHeaderWidth="0"
                                  Foreground="White"
                                  IsReadOnly="True"
                                  AllowDrop="True"
                                  ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                                  RowStyle="{StaticResource DataGridRowStyle}">
                             <DataGrid.Columns>
                                <DataGridTemplateColumn Header="STATUS" Width="120" SortMemberPath="Status">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Status}" Foreground="#AAA" Margin="6,0,0,0" VerticalAlignment="Center"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>

                                <DataGridTemplateColumn Header="FILENAME" Width="360" SortMemberPath="FileName">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding FileName}" FontWeight="Bold" Foreground="White" Margin="6,0,0,0" VerticalAlignment="Center"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>

                                <DataGridTemplateColumn Header="PATH" Width="510" SortMemberPath="FilePath">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding FilePath}" Padding="0,0,20,0" Opacity="0.5" TextTrimming="CharacterEllipsis" Margin="6,0,0,0" VerticalAlignment="Center"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>

                                <DataGridTemplateColumn Header="DURATION" Width="120" SortMemberPath="DurationString">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding DurationString}" Foreground="#888" Margin="6,0,0,0" VerticalAlignment="Center"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>

                                <DataGridTemplateColumn Header="FORMAT" Width="300" SortMemberPath="AudioInfo">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding AudioInfo}" Foreground="#888" Margin="6,0,0,0" VerticalAlignment="Center"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                
                                <!-- Remove Button Column -->
                                <DataGridTemplateColumn Width="50">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Content="X" 
                                                    Command="{Binding DataContext.RemoveFileCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                    CommandParameter="{Binding}"
                                                    Background="Transparent" BorderThickness="0" Foreground="Red" FontWeight="Bold"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                        
                        <!-- Empty State Hint -->
                        <TextBlock Text="Drop Media Files Here" 
                                   VerticalAlignment="Center" HorizontalAlignment="Center" 
                                   Foreground="#555" FontSize="18" FontWeight="Bold"
                                   IsHitTestVisible="False">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Files.Count}" Value="0">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </Grid>
                </Border>
            </Grid>
        </Grid>

        <!-- RIGHT: SETTINGS PANEL -->
        <Border Grid.Column="1" Background="{StaticResource Brush.Panel}" BorderThickness="1,0,0,0" BorderBrush="{StaticResource Brush.Border}" CornerRadius="0" Padding="10">
            <StackPanel>
                
                <TextBlock Text="EXPORT SETTINGS" Style="{StaticResource HeaderStyle}" Margin="0,0,0,20"/>

                <!-- Function Selection Area (Dual Dropdowns) -->
                <StackPanel Margin="0,0,0,20">
                    
                    <!-- VIDEO FUNCTION -->
                    <TextBlock Text="CHOOSE VIDEO FUNCTION" Style="{StaticResource HeaderStyle}" FontSize="{StaticResource Font.Size.Standard}" Margin="0,0,0,10" Foreground="#888"/>
                    <ComboBox ItemsSource="{Binding VideoFormats}" 
                              SelectedItem="{Binding SelectedVideoFormat}"
                              Height="30" Margin="0,0,0,20"
                              Style="{StaticResource {x:Type ComboBox}}">
                        <ComboBox.ItemContainerStyle>
                            <Style TargetType="ComboBoxItem">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding}" Value="--- STANDARD (EXCHANGE) ---">
                                        <Setter Property="IsEnabled" Value="False"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                        <Setter Property="Foreground" Value="{DynamicResource Brush.Accent}"/>
                                        <Setter Property="FontSize" Value="13"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding}" Value="--- BROADCAST &amp; LIVE ---">
                                        <Setter Property="IsEnabled" Value="False"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                        <Setter Property="Foreground" Value="{DynamicResource Brush.Accent}"/>
                                        <Setter Property="FontSize" Value="13"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding}" Value="--- POST-PRODUCTION ---">
                                        <Setter Property="IsEnabled" Value="False"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                        <Setter Property="Foreground" Value="{DynamicResource Brush.Accent}"/>
                                        <Setter Property="FontSize" Value="13"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding}" Value="--- MODERN WEB ---">
                                        <Setter Property="IsEnabled" Value="False"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                        <Setter Property="Foreground" Value="{DynamicResource Brush.Accent}"/>
                                        <Setter Property="FontSize" Value="13"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding}" Value="--- LEGACY &amp; ARCHIVE ---">
                                        <Setter Property="IsEnabled" Value="False"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                        <Setter Property="Foreground" Value="{DynamicResource Brush.Accent}"/>
                                        <Setter Property="FontSize" Value="13"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ComboBox.ItemContainerStyle>
                    </ComboBox>

                    <!-- AUDIO FUNCTION -->
                    <TextBlock Text="CHOOSE AUDIO FUNCTION" Style="{StaticResource HeaderStyle}" FontSize="{StaticResource Font.Size.Standard}" Margin="0,0,0,10" Foreground="#888"/>
                    <ComboBox ItemsSource="{Binding AudioFormats}" 
                              SelectedItem="{Binding SelectedAudioFormat}"
                              Height="30" Margin="0,0,0,10"
                              Style="{StaticResource {x:Type ComboBox}}">
                    </ComboBox>

                </StackPanel>



                <!-- Divider -->
                <Rectangle Height="1" Fill="#333" Margin="0,0,0,20"/>

                <!-- AUDIO SETTINGS -->
                <StackPanel>
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Visibility" Value="Collapsed"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsAudioCategory}" Value="True">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>

                    <TextBlock Text="AUDIO SETTINGS" Style="{StaticResource LabelStyle}" Margin="0,0,0,10" Opacity="0.7"/>
                    
                    <StackPanel Margin="0,0,0,10">
                        <StackPanel Margin="0,0,0,15">
                            <TextBlock Text="Sample Rate" Foreground="#888" Margin="0,0,0,5"/>
                            <ComboBox ItemsSource="{Binding AvailableSampleRates}" SelectedItem="{Binding SelectedSampleRate}"/>
                        </StackPanel>

                        <StackPanel Margin="0,0,0,15">
                             <TextBlock Text="Bit Depth" Foreground="#888" Margin="0,0,0,5"/>
                            <ComboBox ItemsSource="{Binding AvailableBitDepths}" SelectedItem="{Binding SelectedBitDepth}"/>
                        </StackPanel>

                        <StackPanel>
                            <TextBlock Text="Bitrate" Foreground="#888" Margin="0,0,0,5"/>
                            <ComboBox ItemsSource="{Binding AvailableBitrates}" SelectedItem="{Binding SelectedBitrate}" IsEnabled="{Binding AvailableBitrates.Count}">
                                <ComboBox.Style>
                                    <Style TargetType="ComboBox" BasedOn="{StaticResource {x:Type ComboBox}}">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding AvailableBitrates.Count}" Value="0">
                                                <Setter Property="IsEnabled" Value="False"/>
                                                <Setter Property="Opacity" Value="0.3"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </ComboBox.Style>
                            </ComboBox>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>

                <!-- VIDEO SETTINGS -->
                <StackPanel>
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Visibility" Value="Collapsed"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsVideoCategory}" Value="True">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>

                    <TextBlock Text="VIDEO SETTINGS" Style="{StaticResource LabelStyle}" Margin="0,0,0,10" Opacity="0.7"/>

                    <StackPanel Margin="0,0,0,10">
                        <StackPanel Margin="0,0,0,15">
                            <TextBlock Text="Bit Depth (Color)" Foreground="#888" Margin="0,0,0,5"/>
                            <ComboBox ItemsSource="{Binding AvailableVideoBitDepths}" SelectedItem="{Binding SelectedVideoBitDepth}"/>
                        </StackPanel>

                        <StackPanel>
                            <TextBlock Text="Bitrate / Profile" Foreground="#888" Margin="0,0,0,5"/>
                            <ComboBox ItemsSource="{Binding AvailableBitrates}" SelectedItem="{Binding SelectedBitrate}" IsEnabled="{Binding AvailableBitrates.Count}">
                                <ComboBox.Style>
                                    <Style TargetType="ComboBox" BasedOn="{StaticResource {x:Type ComboBox}}">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding AvailableBitrates.Count}" Value="0">
                                                <Setter Property="IsEnabled" Value="False"/>
                                                <Setter Property="Opacity" Value="0.3"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </ComboBox.Style>
                            </ComboBox>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>

                <!-- Divider -->
                <Rectangle Height="1" Fill="#333" Margin="0,10,0,20"/>

                <TextBlock Text="OUTPUT SETTINGS" Style="{StaticResource LabelStyle}" Margin="0,0,0,5" Opacity="0.7"/>
                <!-- Container Indicator (Hidden until selection) -->
                <TextBlock Text="{Binding OutputExtension, StringFormat='CONTAINER: {0}'}" 
                           Foreground="#666" FontSize="11" Margin="0,0,0,15" 
                           FontWeight="SemiBold">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock" BasedOn="{StaticResource LabelStyle}">
                            <Setter Property="Visibility" Value="Visible"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding OutputExtension}" Value="">
                                    <Setter Property="Visibility" Value="Hidden"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding OutputExtension}" Value="{x:Null}">
                                    <Setter Property="Visibility" Value="Hidden"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>

                 <Grid Margin="0,0,0,20">
                     <Grid.ColumnDefinitions>
                         <ColumnDefinition Width="*"/>
                         <ColumnDefinition Width="Auto"/>
                     </Grid.ColumnDefinitions>
                     <TextBox Text="{Binding DestinationFolder, TargetNullValue='Source Location'}" 
                              IsReadOnly="True" Height="30" VerticalContentAlignment="Center" 
                              Background="#151515" BorderThickness="0" Foreground="#AAA"/>
                     <Button Grid.Column="1" Content="..." Width="40" Command="{Binding PickDestinationCommand}" Style="{StaticResource ActionButtonStyle}" Margin="5,0,0,0"/>
                 </Grid>


                 <StackPanel Margin="0,20,0,0">
                     <!-- Progress Bar -->
                     <TextBlock Text="{Binding StatusMessage}" HorizontalAlignment="Center" Foreground="{DynamicResource Brush.Accent}" Margin="0,0,0,10" FontWeight="Bold">
                         <TextBlock.Style>
                             <Style TargetType="TextBlock">
                                 <Style.Triggers>
                                     <MultiDataTrigger>
                                         <MultiDataTrigger.Conditions>
                                             <Condition Binding="{Binding IsEnabled, ElementName=StartTranscodeButton}" Value="False"/>
                                             <Condition Binding="{Binding Text, RelativeSource={RelativeSource Self}}" Value="Ready"/>
                                         </MultiDataTrigger.Conditions>
                                         <Setter Property="Visibility" Value="Hidden"/>
                                     </MultiDataTrigger>
                                 </Style.Triggers>
                             </Style>
                         </TextBlock.Style>
                     </TextBlock>
                     <ProgressBar Value="{Binding TotalProgressValue}" Height="10" Background="#222" BorderThickness="0" Foreground="{DynamicResource Brush.Accent}" Margin="0,0,0,20">
                         <ProgressBar.Style>
                             <Style TargetType="ProgressBar">
                                 <Style.Triggers>
                                     <DataTrigger Binding="{Binding IsBusy}" Value="True">
                                         <Setter Property="Visibility" Value="Visible"/>
                                     </DataTrigger>
                                      <DataTrigger Binding="{Binding IsBusy}" Value="False">
                                         <Setter Property="Visibility" Value="Collapsed"/>
                                     </DataTrigger>
                                 </Style.Triggers>
                             </Style>
                         </ProgressBar.Style>
                     </ProgressBar>

                     <!-- START BUTTON -->
                     <Button x:Name="StartTranscodeButton" 
                             Content="START TRANSCODE" 
                             Command="{Binding StartTranscodeCommand}"
                             Height="26"
                             Style="{StaticResource BlueActionButtonStyle}">
                     </Button>
                 </StackPanel>

            </StackPanel>
        </Border>
    </Grid>
</UserControl>
